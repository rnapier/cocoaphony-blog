
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Cocoaphony</title>
  <meta name="author" content="Rob Napier">

  
  <meta name="description" content="I’m back in full book-writing mode, now working with Mugunth Kumar, who is brilliant. Go check out his stuff. Hopefully we’ll have something &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://robnapier.net/page7">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Cocoaphony" type="application/atom+xml">
  <link href="https://micro.blog/cocoaphony" rel="me" />
  <link href="https://twitter.com/cocoaphony" rel="me" />
  <!-- <script src="/javascripts/modernizr-2.0.js"></script> -->
  <!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> -->
  <!-- <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script> -->
  <!-- <script src="/javascripts/octopress.js" type="text/javascript"></script> -->
  
</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Cocoaphony</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>

<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/laying-out-text-with-coretext">Laying Out Text With Core Text</a></h1>
    
    
      <p class="meta">
        









<time datetime="2011-05-20T11:09:12-04:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I’m back in full book-writing mode, now working with <a href="http://mugunthkumar.com/">Mugunth Kumar</a>, who is brilliant. Go check out his stuff. Hopefully we’ll have something published and in all your hands by the end of the year. The book has taken up most of my writing time, so the blog will continue to be a bit quiet, but sometimes I like to answer a Stackoverflow question a bit more fully than I can there.</p>

<p>Today’s question is about <a href="http://stackoverflow.com/questions/6062420/core-text-performance/6062816#6062816">laying out text without <code class="highlighter-rouge">CTFramesetter</code></a>. We’re going to take a whirlwind tour through some CoreText code to demonstrate this. It’s not quite what the OP was asking about, but it shows some techniques and I had it handy. I’ll be writing a whole chapter on Core Text soon.</p>

<p>The goal of this project was to make “pinch” view. It lays out text in a view, and where ever you touch, the text is pinched towards that point. It’s not meant to be really useful. Everything is done in <code class="highlighter-rouge">drawRect:</code>, which is ok in this case, since we only draw when we’re dirty, and when we’re dirty we have to redraw everything anyway. But in many cases, you’d want to do these calculations elsewhere, and only do final drawing in <code class="highlighter-rouge">drawRect:</code>.</p>

<p>We start with some basic view layout, and loop until we run out of text or run out of vertical space in the view.
</div>
  
  
    <footer>
      <a rel="full-article" href="/laying-out-text-with-coretext">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/wrapping-text-around-shape-with-coretext">Wrapping Text Around a Shape With CoreText</a></h1>
    
    
      <p class="meta">
        









<time datetime="2011-03-25T12:15:19-04:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>CoreText is a very powerful system for laying out text in arbitrary ways. This is going to be a bit of a whirlwind tour of it to help out <a href="http://stackoverflow.com/questions/5284516/how-can-i-draw-image-with-text-wrapping-on-ios">nonamelive on StackOverflow</a>.&lt;/a&gt; I’m working on an advanced iOS book right now, and I’ll have a longer writeup there.
</div>
  
  
    <footer>
      <a rel="full-article" href="/wrapping-text-around-shape-with-coretext">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/returning-deep-hack">Returning From the Deep Hack</a></h1>
    
    
      <p class="meta">
        









<time datetime="2011-02-02T23:33:05-05:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For the last several months, all of my technical time not devoted to my primary employment has been absorbed in a <a href="http://itunes.apple.com/us/app/the-daily/id411516732">little iPad project</a>. Nights and weekends that I usually would spend writing blog posts, chatting on Stackoverflow, or working on PandoraBoy have instead been spent on one of the more interesting projects I’ve worked on. But now it’s front-page on apple.com, soaring up the charts, and I’m rolling onto other things. Top of my list, when not working on an awesome IM/Phone app full time, is starting work on a new iOS book, but close after <em>that</em> are PandoraBoy improvements, Cocoaphony and Stackoverflow. And maybe a little skiing. And there is that go-kart the family has started building. But still, blogging is up there, and I should have a new build of PandoraBoy out in the next week that fixes up some annoying bugs.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/clipping-cgrect-cgpath">Clipping a CGRect to a CGPath</a></h1>
    
    
      <p class="meta">
        









<time datetime="2010-09-09T10:49:07-04:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I’ve been playing with Core Text recently, and one of the things I wanted to do was layout text in an arbitrary CGPath. On Mac, you’d do this with NSLayoutManager, but iOS doesn’t have that so we have to build our own. I’ll discuss Core Text more later, but one of the steps along this problem is how to clip a CGRect to a CGPath. I found several discussions of finding CGPath intersections, all explaining the basic technique. Draw the things you care about into a bitmap context and then inspect the pixels to see where they overlap. Clear enough, but it was hard to find a small code sample that demonstrated this with Core Graphics.</p>

<p>For my purposes, I want the first full-height rectangle within the intersection of the line rectangle and the CGPath. Later I will expand this code to find all full-height rectangles within the intersection (there can be more than one), but this is enough to demonstrate the point.
</div>
  
  
    <footer>
      <a rel="full-article" href="/clipping-cgrect-cgpath">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/pandoras-profile-popup">Pandora's "Profile" Pop-up</a></h1>
    
    
      <p class="meta">
        









<time datetime="2010-08-06T10:14:58-04:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Several people have noted that PandoraBoy is displaying a “Profile” window over the player that interferes with the player. This is a notification from Pandora because they’ve changed their privacy settings (you can now make your profile private, and they want to know if you want that).</p>

<p>This should be a one-time event for existing accounts. I suspect that new accounts will not see it. The solution is to open www.pandora.com in Safari, answer the question, and then re-launch PB.</p>

<p>PandoraBoy goes directly to the the mini-player on launch. Pandora doesn’t code for that since it’s impossible from the website. So sometimes they make interfaces that are larger than the mini-player without updating the mini-player code to resize. PB doesn’t resize the window (it doesn’t know how large it should be). It just relies on the mini-player to do it in Javascript, but in cases like this, the mini-player also doesn’t know how large the window should be.</p>

<p>BTW, I often am asked why PB doesn’t make the window resizable for cases like this. The answer is that it doesn’t help. The mini-player is a flash app, and has a clipping frame independent of the window. So while you can resize the window, the content is still clipped at the border of the flash app. Ah, the wonders of Flash.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/pandoraboy-082-fixes-flash">PandoraBoy 0.8.2 - Fixes Flash</a></h1>
    
    
      <p class="meta">
        









<time datetime="2010-07-15T23:30:24-04:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For those of you having trouble with Flash 10.1, I’ve fixed PB to handle it. This moves from the hackish “dig around in the NetscapePlugin objects and call undocumented methods” approach to a standard CGEvent based keyboard injection. You can’t use NSApp’s sendEvent: to talk to Flash (probably because Flash is not in Cocoa). But the following code is a good general purpose “send me a virtual keystroke.”
</div>
  
  
    <footer>
      <a rel="full-article" href="/pandoraboy-082-fixes-flash">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/building-address-book-plugins">Building Address Book Plugins</a></h1>
    
    
      <p class="meta">
        









<time datetime="2010-07-15T16:17:22-04:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Just a reminder, because the template doesn’t seem to set this up correctly. To build an Address Book action plugin for 10.6, you need to compile for x86_64 or it will silently not show up. If you plan to support 10.5, you’ll need i386 as well. The template seems to build 32-bit universal (i386, ppc) by default.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/hijacking-methodexchangeimplementations">Hijacking With method_exchangeImplementations()</a></h1>
    
    
      <p class="meta">
        









<time datetime="2010-07-07T18:17:25-04:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>Based on a <a href="http://stackoverflow.com/questions/1929740/is-there-a-way-to-retrieve-every-responder-that-has-handled-a-uitouch">discussion</a> from StackOverflow.</em></p>

<p>Sometimes you want to inject some logic into a method you don’t control. The most common sane reason to do this is for debugging or profiling. For instance, you might want to log every time the various <code class="highlighter-rouge">NSNotificationCenter</code> methods are called so you can determine if that’s a performance bottleneck. (As I discovered myself, if you have thousands of notification observations in your system, it can be a serious performance problem.)</p>

<p>In most OOP languages your only option would be to subclass the object you want to instrument and then arrange for every instance of that object to be your subclass. In many cases that’s either very difficult or outright impossible, particularly if the object is used internally by a system framework. But Objective-C is highly dynamic, and message dispatching is resolved at runtime. You can modify how it works.
</div>
  
  
    <footer>
      <a rel="full-article" href="/hijacking-methodexchangeimplementations">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/wrapping-c-take-2-2">Wrapping C++ - Take 2, Part 2</a></h1>
    
    
      <p class="meta">
        









<time datetime="2010-06-10T01:48:41-04:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In the <a href="/wrapping-c-take-2-1">last post</a>, we discussed how to wrap simple C++ objects in Objective-C. But how about more complex objects, particularly with <code class="highlighter-rouge">shared_ptr</code>?</div>
  
  
    <footer>
      <a rel="full-article" href="/wrapping-c-take-2-2">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/wrapping-c-take-2-1">Wrapping C++ - Take 2, Part 1</a></h1>
    
    
      <p class="meta">
        









<time datetime="2010-06-09T02:39:04-04:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Last year, I presented <a href="/wrapping-c-objc">an approach to wrapping C++</a>. Since then, I’ve been introduced to other approaches, particularly from gf who helped me better understand opaque objects. Since I do a lot of cross-language work, I’ve had some opportunity to play with and expand this, and so I’d like to update my C++ wrapping approach.</p>

<p>First, to remind everyone of the problem: you have a C++ object that you want to consume in Objective-C. That’s easy in ObjC++, but if you make an ivar that references a C++ class, then the header file can only be included by ObjC++ classes. This quickly spreads .mm files throughout your project, creating all kinds of headaches. ObjC is a beautiful thing, and C++ is fine, but ObjC++ is a crazy land that should be carefully segregated from civilized code. So how do we do it?</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/wrapping-c-take-2-1">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page8">&larr; Older</a>
    
    <a href="/archives">Blog Archives</a>
    
    <a class="next" href="/page6">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - <a href="mailto:rob@neverwood.org">Rob Napier</a> - <a href="https://twitter.com/cocoaphony">@cocoaphony</a> - 
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  









<!-- Fathom - simple website analytics - https://usefathom.com -->
<script>
(function(f, a, t, h, o, m){
a[h]=a[h]||function(){
    (a[h].q=a[h].q||[]).push(arguments)
};
o=f.createElement('script'),
m=f.getElementsByTagName('script')[0];
o.async=1; o.src=t; o.id='fathom-script';
m.parentNode.insertBefore(o,m)
})(document, window, '//cdn.usefathom.com/tracker.js', 'fathom');
fathom('set', 'siteId', 'MSRAZWIU');
fathom('trackPageview');
</script>
<!-- / Fathom -->




</body>
</html>
