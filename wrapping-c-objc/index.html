
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Wrapping C++ in ObjC - Cocoaphony</title>
  <meta name="author" content="Rob Napier">

  
  <meta name="description" content="See Take 2 for an updated approach to this problem. When faced with mixing C++ and ObjC code, there are two main approaches. One is to just work in &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://robnapier.net/wrapping-c-objc">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Cocoaphony" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8553355-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Cocoaphony</a></h1>
  
    <h2>Mac and iPhone, on the brain</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:robnapier.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Wrapping C++ in ObjC</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-14T10:20:03-04:00" pubdate data-updated="true">Apr 14<span>th</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><em>See <a href="/blog/wrapping-c-take-2-1">Take 2</a> for an updated approach to this problem.</em></p>

<p>When faced with mixing C++ and ObjC code, there are two main approaches. One is to just work in Objective-C++ through the entire project. I don&rsquo;t like this approach. I find the mixing of ObjC and C++ classes very confusing, since they cannot be used interchangeably and require completely different memory management. The mix of class hierarchies and naming conventions lead to a lot of confusion when we introduce people to code that does this kind of mixing.</p>

<p>My opinion is that ObjC and C++ have very different patterns, so it is important to pick one to be in charge and wrap the other. So if you basically have an C++ program than needs a little ObjC to talk to the UI, then wrap the ObjC in C++ objects. If you basically have an ObjC program that needs a C++ middleware, then wrap the C++ objects.<!-- more --></p>

<p>Here&rsquo;s how I usually wrap a C++ object (CFoo) into a ObjC object (Foo):</p>

<h4>Foo.h</h4>


<pre lang="objc">
typedef void* CFooRef;
@interface Foo : NSObject {
   CFooRef _fooRef;
}
</pre>


<h4>Foo+CPP.h</h4>


<pre lang="objc">
#import "Foo.h"
@interface Foo (CPP)
@property (readwrite, assign) CFoo* foo;
@end
</pre>


<h4>Foo.mm</h4>


<pre lang="objc">
#import "Foo+CPP.h"
@interface Foo () {
@property (readwrite, assign) CFooRef fooRef;
@end

class CFoo { ... }; // Define the C++ object here, or in a separate file.

@implementation Foo
@synthesize fooRef=_fooRef;

- (CFoo*)foo {
   return static_cast<cfoo*>([self fooRef]);
}

- (void)setFoo:(CFoo*)aFoo {
   [self setFooRef:aFoo];
}
@end
</pre>


<p>The goal of this is to provide a pure-ObjC interface (Foo.h) that has no C++ in it. The CFooRef type allows ObjC to treat the C++ object as an opaque type. Other C++ wrapper objects can access the underlying C++ object using the Foo+CPP.h interface, but I only provide this if there are other objects that really need it.</p>

<p>In general, I then provide ObjC methods to all the relevant C++ methods. This way, higher level classes (generally UI classes) can be pure ObjC. This makes it much easier to tie these C++ objects into Cocoa. I can use the wrapper to make the C++ bindings compliant, put them into NSArrays, etc. And when we hire ObjC developers, they can focus on ObjC without learning the intricacies of C++. Similarly, the C++ stays pure C++, making it much easier for C++ developers to work on, and keeps it portable. Only the guys who work on the wrappers (guys like me) have to really keep their head in both languages and both sets of patterns. And we keep the wrappers as thin as possible to minimize the work done there. Ideally, the wrappers can do simple language translation and nothing else.</p>

<p>After years of evolving this approach in multiple projects, this has been the most successful for our large mixed-language projects.</p>

<p><strong>EDIT:</strong> After doing this for a long time, I&rsquo;ve learned that using &ldquo;#ifdef __cplusplus&rdquo; in your header file around the C++ code can be much easier than maintaining a separate &ldquo;+CPP&rdquo; header.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Rob Napier</span></span>

      








  


<time datetime="2009-04-14T10:20:03-04:00" pubdate data-updated="true">Apr 14<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/cocoa/'>cocoa</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://robnapier.net/wrapping-c-objc/" data-via="cocoaphony" data-counturl="http://robnapier.net/wrapping-c-objc/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/learning-iphone-scratch/" title="Previous Post: Learning iPhone from scratch">&laquo; Learning iPhone from scratch</a>
      
      
        <a class="basic-alignment right" href="/iphone-course-syllabus/" title="Next Post: iPhone Course Syllabus">iPhone Course Syllabus &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
	<h1>Coming Jan. 2014</h1>
  <a href="http://www.amazon.com/dp/1118818342"><img src="/images/ios7_ptl_cover.png" alt="iOS 7 Programing Pushing the Limits" /></a>
</section><section>
  <h1><a href="http://renaissance.io/2014">Renaissance 2014</a></h1>
    <p>I'll be discussing <a href="http://renaissance.io/2014/sessions/get_security_and_privacy_right">security best practices</a> at the Renaissance conference, January 29-31, 2014 in San Francisco.</p>
</section><section>
  <h1>About Cocoaphony</h1>
  <p>Rob is a builder of treehouses, hiker, proud father, and from time to time, a Mac and iPhone developer. Cocoaphony is where he pontificates on various issues fascinating to Cocoa developers, and occasionally other topics of technical interest.</p>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - <a href="mailto:robnapier@gmail.com">Rob Napier</a> - <a href="https://twitter.com/cocoaphony">@cocoaphony</a> - 
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
